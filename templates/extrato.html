<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Extrato</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/extrato.css') }}">
    <script src="static/js/extrato.js" defer></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/litepicker/dist/css/litepicker.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.0/css/all.min.css">

<script src="https://cdn.jsdelivr.net/npm/litepicker/dist/litepicker.js"></script>
</head>
<body>



    <div class="container-detalhes" >

        <h2 style="text-align: center;">Extrato</h2>
            <!-- Filtro -->
<!-- Filtro -->
<form method="GET" action="{{ url_for('gasto.extrato') }}" class="filtro-form" id="filtro-form">
    <!-- Bot√£o de per√≠odo -->
    <div class="periodo-wrapper">
        <label for="data">Per√≠odo:</label>
        <input type="text" id="periodo-picker" readonly placeholder="Selecione o per√≠odo" />
        <input type="hidden" id="data_inicio" name="data_inicio" value="{{ data_inicio }}">
<input type="hidden" id="data_fim" name="data_fim" value="{{ data_fim }}">

<!-- <input type="hidden" id="categoria" name="categoria" value="{{ categoria }}"> -->
<br>
    </div>
    <br>
    <!-- Dropdown de categoria -->
    <label for="categoria">Categoria:</label>
    <select name="categoria" id="categoria">
        <option value="Todas">Todas</option>
        <option value="Alimenta√ß√£o">Alimenta√ß√£o</option>
        <option value="Sa√∫de">Sa√∫de</option>
        <option value="Mobilidade">Mobilidade</option>
        <option value="Entretenimento">Entretenimento</option>
        <option value="Moradia">Moradia</option>
        <option value="Outros">Outros</option>
        <option value="D√≠vidas">D√≠vidas</option>

        {% for cat in categorias %}
            <option value="{{ cat }}" {% if request.args.get('categoria') == cat %}selected{% endif %}>{{ cat }}</option>
        {% endfor %}
    </select>

    <button type="submit" class="botao-filtrar">Filtrar</button>
</form>


        <table>
            <thead>
                <tr>
                    <!-- <th>Data</th> -->
                    <th>Categoria</th>
                    <th>Descri√ß√£o</th>
                    <th>Valor (R$)</th>
                    <th></th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
             

                {% for data, lista in gastos_agrupados.items() %}
                <!-- Linha com a data -->
                <tr style="background-color: #f5f5f5;">
                    <td colspan="4" style="text-align: justify; padding: 8px 0;"><strong>üìÖ {{ data }}</strong></td>
                </tr>
            
                {% for gasto in lista %}
                    <tr class="gasto"
                    data-id="{{ gasto[4] }}"
                     style="background-color: {% if loop.index0 % 2 == 0 %}#eaffea{% else %}white{% endif %}; line-height: 1.6;">
                        <td>{{ gasto[0] }}</td>
                        <td>{{ gasto[1] }}</td>
                        <td>R$ {{ gasto[2] | round(2) }}</td>
                        <td>
                            <i class="fas fa-edit edit-icon"
                            data-data="{{ gasto[3] }}"
                            data-categoria="{{ gasto[0] }}"
                            data-descricao="{{ gasto[1] }}"
                            data-valor="{{ gasto[2] }}"
                            title="Editar"></i>
                        </td>
                        <td>
                            <i class="fa-solid fa-trash"
                            data-id="{{ gasto[4] }}"
                            ></i>
                        </td>
                    </tr>
                {% endfor %}
            {% endfor %}
            

              </tbody>
              <tfoot>
                <tr>
                    <td colspan="2" style="text-align: left; font-weight: bold;">Total do per√≠odo:</td>
                    <td></td>
                    <td colspan="2" style="font-weight: bold;">
                        R$ {{ '%.2f' | format(soma_gastos) }}
                    </td>
                </tr>
            </tfoot>
            
              
        </table>

        <!-- Pagina√ß√£o -->
        <div class="pagination">
            {% if page > 1 %}
                <!-- <a href="{{ url_for('gasto.extrato', page=page-1) }}" class="button">‚Üê Anterior</a> -->
                <a href="{{ url_for('gasto.extrato', page=page-1, data_inicio=request.args.get('data_inicio'), data_fim=request.args.get('data_fim'), categoria=request.args.get('categoria')) }}" class="button">‚Üê Anterior</a>

            {% endif %}
            
            <span>P√°gina {{ page }}</span>

            {% if total > page * per_page %}
                <!-- <a href="{{ url_for('gasto.extrato', page=page+1) }}" class="button">Pr√≥xima ‚Üí</a> -->
                <a href="{{ url_for('gasto.extrato', page=page+1, data_inicio=request.args.get('data_inicio'), data_fim=request.args.get('data_fim'), categoria=request.args.get('categoria')) }}" class="button">Pr√≥xima ‚Üí</a>

            {% endif %}
            <a href="{{ url_for('gasto.index') }}" class="button-detalhes">Voltar</a>
        </div>

        
    </div>

<!-- Modal de Edi√ß√£o -->
<div id="modal-editar" class="modal" style="display: none;">
    <div class="modal-content">
      <span class="close" id="fechar-modal">&times;</span>
      <h3>Editar Gasto</h3>
      <form id="form-editar" method="POST" action="{{ url_for('gasto.editar_gasto') }}">
        <label for="editar-data">Data:</label>
        <input type="date" name="data" id="editar-data">
  
        <label for="editar-categoria">Categoria:</label>
        <input type="text" name="categoria" id="editar-categoria" required>
  
        <label for="editar-descricao">Descri√ß√£o:</label>
        <input type="text" name="gasto" id="editar-descricao" required>
  
        <label for="editar-valor">Valor (R$):</label>
        <input type="number" step="0.01" name="valor" id="editar-valor" required>
  
        <button type="submit" class="botao-salvar">Salvar</button>
      </form>
    </div>
  </div>
  
 <!-- Modal confirma√ß√£o  -->
 <div id="modal-confirmar-exclusao" class="modal" style="display: none;">
    <div class="modal-content">
      <span class="close" id="fechar-modal-excluir">&times;</span>
      <h3>Tem certeza que deseja excluir este gasto?</h3>
      <form method="POST" action="{{ url_for('gasto.deletar_gasto') }}"> 
        <input type="hidden" id="id-gasto-excluir" name="id">
        <button type="submit" id="confirmar-exclusao" class="botao-salvar" style="margin-top: 12px;">OK</button>
    </form>
    
    </div>
  </div>
  

</body>
</html>